
1. I think for some reason we send alignment request to the endpoint twice:

[toast] טוען פרק...
toast.js:8 [toast] מיישר תזמונים: 0 מילים, 0.0 שניות — נשלח…
toast.js:8 [toast] מיישר תזמונים: 10 מילים, 5.5 שניות — נשלח…
toast.js:8 [toast:success] מיישר תזמונים: 10 מילים, 5.5 שניות — עודכנו 10 — 19.1s
toast.js:8 [toast:success] השינויים נשמרו בהצלחה
toast.js:8 [toast:success] אימות גרסה הצליח (hash 0548d1e3)

here is the server log:
2025-09-16 05:15:36,679 | INFO | 127.0.0.1 - - [16/Sep/2025 05:15:36] "GET /audio/אבות%20האומה/2024.05.09%20%231%20כללים%20במקום%20חוקים.opus HTTP/1.1" 206 -
2025-09-16 05:15:36,937 | INFO | [TIMING] [REQ:fae498d3] Audio request received for: אבות האומה/2024.05.09 #1 כללים במקום חוקים.opus
2025-09-16 05:15:36,938 | INFO | [TIMING] [REQ:fae498d3] filename.repr='אבות האומה/2024.05.09 #1 כללים במקום חוקים.opus'
2025-09-16 05:15:36,938 | INFO | [TIMING] [REQ:fae498d3] recovered_from_uri_variants=["'אבות האומה/2024.05.09 #1 כללים במקום חוקים.opus'", "'אבות האומה/2024.05.09 #1 כללים במקום חוקים.opus'", "'אבות האומה/2024.05.09 #1 כללים במקום חוקים.opus'", "'×\\x90×\\x91×\\x95×ª ×\\x94×\\x90×\\x95×\\x9e×\\x94/2024.05.09 #1 ×\\x9b×\\x9c×\\x9c×\\x99×\\x9d ×\\x91×\\x9e×§×\\x95×\\x9d ×\\x97×\\x95×§×\\x99×\\x9d.opus'"]
2025-09-16 05:15:36,939 | INFO | [TIMING] [REQ:fae498d3] latin1->utf8 candidate=' /2024.05.09 #1   .opus'
2025-09-16 05:15:36,940 | INFO | [TIMING] [REQ:fae498d3] Streaming local audio: C:\Users\Ofir Gaash\Desktop\facebook\sonar-test\audio\blobs\1bad097c3469b425431fa6ea786784353da9b25cbefd36cf06cdfc83dc17b7b6
2025-09-16 05:15:36,941 | INFO | [TIMING] [REQ:fae498d3] audio_path.repr='C:\\Users\\Ofir Gaash\\Desktop\\facebook\\sonar-test\\audio\\blobs\\1bad097c3469b425431fa6ea786784353da9b25cbefd36cf06cdfc83dc17b7b6'
2025-09-16 05:15:36,941 | INFO | [TIMING] [REQ:fae498d3] Starting to send file: C:\Users\Ofir Gaash\Desktop\facebook\sonar-test\audio\blobs\1bad097c3469b425431fa6ea786784353da9b25cbefd36cf06cdfc83dc17b7b6
2025-09-16 05:15:36,944 | INFO | [TIMING] [REQ:fae498d3] Range file served in 2.20ms
2025-09-16 05:15:36,945 | INFO | [TIMING] [REQ:fae498d3] Serving range request: bytes 1998848-14798306/14798307
2025-09-16 05:15:36,946 | INFO | 127.0.0.1 - - [16/Sep/2025 05:15:36] "GET /audio/אבות%20האומה/2024.05.09%20%231%20כללים%20במקום%20חוקים.opus HTTP/1.1" 206 -
2025-09-16 05:15:37,233 | INFO | 127.0.0.1 - - [16/Sep/2025 05:15:37] "GET /favicon.ico HTTP/1.1" 404 -
2025-09-16 05:16:09,895 | INFO | 127.0.0.1 - - [16/Sep/2025 05:16:09] "GET /episode?folder=אבות%20האומה&file=2024.05.09%20%231%20כללים%20במקום%20חוקים.opus HTTP/1.1" 200 -
2025-09-16 05:16:10,035 | INFO | 127.0.0.1 - - [16/Sep/2025 05:16:10] "GET /transcripts/history?doc=אבות%20האומה%2F2024.05.09%20%231%20כללים%20במקום%20חוקים.opus HTTP/1.1" 200 -
2025-09-16 05:16:10,387 | INFO | 127.0.0.1 - - [16/Sep/2025 05:16:10] "GET /transcripts/get?doc=אבות%20האומה%2F2024.05.09%20%231%20כללים%20במקום%20חוקים.opus&version=1 HTTP/1.1" 200 -
2025-09-16 05:16:10,622 | INFO | 127.0.0.1 - - [16/Sep/2025 05:16:10] "GET /transcripts/edits?doc=אבות%20האומה%2F2024.05.09%20%231%20כללים%20במקום%20חוקים.opus HTTP/1.1" 200 -


2. look at the weird timings in the "השוואה" tab in the diff card:

שכבות שינויים עבור אבות האומה/2024.05.09 #1 כללים במקום חוקים.opus 
מאת dev@ivrit.ai
— v0 → v1
איל,אין,
⏱ שינויים בתזמונים (קטעים 0–1)
נדב · start 3.280→3.963 (+0.683), end 3.960→4.043 (+0.083)
אבקסיס · start 3.960→6.692 (+2.732), end 4.460→8.358 (+3.898)
ואריאל · start 4.460→8.559 (+4.099), end 4.920→8.780 (+3.860)
שנאבל · start 4.920→8.780 (+3.860), end 5.260→8.980 (+3.720)
עם · start 5.260→8.780 (+3.520), end 5.700→8.980 (+3.280)
אבות · start 5.700→8.780 (+3.080), end 6.960→8.980 (+2.020)
האומה · start 6.960→8.780 (+1.820), end 7.280→8.980 (+1.700)
מבית · start 8.240→8.780 (+0.540), end 8.420→8.980 (+0.560)
אול · start 8.480→8.780 (+0.300), end 8.640→8.980 (+0.340)
איל, · start 8.640→8.780 (+0.140), end 8.820→8.980 (+0.160)

what can cause this weird behaviour (almost all the words are suddenly changed drastically 8.780-8.980)

we need to investigate the exact alignment algorithm...

3. I want us to log the exact response from the alignment endpoint (silence-remover.com)
and save the cut audio in an 'audio-log' folder instead of throwing that away...

   - [DONE] Backend now saves cut WAV and raw JSON response under `audio-log/` (or `AUDIO_LOG_DIR`).
   - [DONE] Applies to both pre-align (save) and manual align_segment.
   - Artifacts include doc, seg, timestamps, and clip window in filenames.


4. it seems like after a successful alignment, the corrections are dropped/reverted to initial state in the transcript card (but not in the diff card where you can see the actual fixes, which means the data )

5. the goal is to have automated tests - no manual clicks, full coverage

6. Avoid duplicate alignment calls
   - [NEW] Added config `ALIGN_PREALIGN_ON_SAVE` (default: true). Set to false to disable pre-align during save to prevent duplicate calls when UI also triggers `align_segment`.
   - Investigate UI flow to ensure only one alignment pathway is invoked.
